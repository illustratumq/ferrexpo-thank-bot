from aiogram import Dispatcher
from aiogram.types import Message

from app.database.services.repos import UserRepo, PointRepo
from app.keyboards.reply.menu import main_menu_kb, Buttons, my_profile_kb

rules_str = '''
<b>–í–¥—è—á–Ω—ñ—Å—Ç—å</b> - —Ü–µ –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–π –µ–º–æ—Ü—ñ–π–Ω–∏–π —Å—Ç–∞–Ω, –∫–æ–ª–∏ –ª—é–¥–∏–Ω–∞ –≤–∏–∑–Ω–∞—î —Ç–∞ —Ü—ñ–Ω—É—î —Ç–µ, —â–æ –æ—Ç—Ä–∏–º–∞–ª–∞ —É –∂–∏—Ç—Ç—ñ. <b>–í–¥—è—á–Ω—ñ—Å—Ç—å –º–∞—î –≤–µ–ª–∏–∫—É —Å–∏–ª—É!</b>

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ü—å–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É, –º–∏ –ø—Ä–∞–≥–Ω–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ –ü—Ä–∞–∫—Ç–∏–∫—É –í–¥—è—á–Ω–æ—Å—Ç—ñ –ø—Ä–æ—Å—Ç–æ—é, —Ñ–∞–Ω–æ–≤–æ—é —Ç–∞ –ø—Ä–∏—î–º–Ω–æ—é! üß° –ù–∞ –ø–æ—á–∞—Ç–∫—É –∫–æ–∂–Ω–æ–≥–æ –º—ñ—Å—è—Ü—è, —Ç–∏ –±—É–¥–µ—à –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ 100 wellcoin-—ñ–≤ (–±–∞–ª—ñ–≤). –ö—ñ–ª—å–∫—ñ—Å—Ç—å wellcoin-—ñ–≤ –¥–æ —Å–≤–æ—ó—Ö –ø–æ–¥—è–∫ —Ç–∏ –º–æ–∂–µ—à —Ä–æ–∑–ø–æ–¥—ñ–ª—è—Ç–∏ —ó—Ö –Ω–∞ –≤–ª–∞—Å–Ω–∏–π —Ä–æ–∑—Å—É–¥.

–¶–µ–π —á–∞—Ç-–±–æ—Ç –¥–æ–ø–æ–º–æ–∂–µ —Ç–æ–±—ñ:
‚úÖ —à–≤–∏–¥–∫–æ —Ç–∞ –∑—Ä—É—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ç–≤–æ—ó —Ç–µ–ø–ª—ñ —Å–ª–æ–≤–∞ –∫–æ–ª–µ–≥–∞–º;
‚úÖ —Ä–æ–∑–ø–æ–¥—ñ–ª—è—Ç–∏ —Ç–∞ —Ä–∞—Ö—É–≤–∞—Ç–∏ wellcoin-–∏ üíö
‚úÖ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ–¥—è–∫–∏ –≤—ñ–¥ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –∑–∞ —Ç–≤–æ—ó –¥–æ–±—Ä—ñ –≤—á–∏–Ω–∫–∏;
‚úÖ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ —Å–µ–±–µ —É —Ä–µ—Å—É—Ä—Å–Ω–æ–º—É —Å—Ç–∞–Ω—ñ üòé

<b>üîπ –ü–µ—Ä–µ–¥–∞—á–∞ —Å–≤–æ—ó—Ö wellcoin-—ñ–≤ (–±–∞–ª—ñ–≤) —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ 4 –∫—Ä–æ–∫—ñ–≤:</b>
1 - –≤–∏–±—ñ—Ä –∫–æ–ª–µ–≥–∏, –∫–æ–º—É —Ç–∏ —Ö–æ—á–µ—à –ø–æ–¥—è–∫—É–≤–∞—Ç–∏ –∑–∞ –¥–æ–±—Ä–æ, —è–∫–µ –≤–æ–Ω–∞/–≤—ñ–Ω –∑—Ä–æ–±–∏–ª–∏ –¥–ª—è —Ç–µ–±–µ —É —Ü—å–æ–º—É –º—ñ—Å—è—Ü—ñ.
2 - –Ω–∞–ø–∏—Å–∞—Ç–∏ —Ç–µ–ø–ª—ñ —Å–ª–æ–≤–∞ —Ç–∞ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ —Ä–æ–∑–ø–∏—Å–∞—Ç–∏, –∑–∞ —â–æ —Å–∞–º–µ —Ç–∏ –¥—è–∫—É—î—à.
3 - –≤–∫–∞–∑–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å wellcoin-—ñ–≤, —è–∫—ñ —Ö–æ—á–µ—à –¥–æ–¥–∞—Ç–∏.
4 - –≤–∫–∞–∂–∏, –∑–∞ —è–∫—É —Å–∞–º–µ —Ü—ñ–Ω–Ω—ñ—Å—Ç—å —Ç–∏ –≤–¥—è—á–Ω–∞/-–Ω–∏–π?

–í –∫—ñ–Ω—Ü—ñ –º—ñ—Å—è—Ü—è –º–∏ –ø—ñ–¥—Ä–∞—Ö—É—î–º–æ –±–∞–ª–∏ —Ç–∞ –≤–∏–∑–Ω–∞—á–∏–º–æ –ø–µ—Ä–µ–º–æ–∂—Ü—ñ–≤, —è–∫—ñ –∑—ñ–±—Ä–∞—Ç–∏ –Ω–∞–π–±—ñ–ª—å—à—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å wellcoin-—ñ–≤ - –∑—Ä–æ–±–∏–ª–∏ –¥–æ–±—Ä–∞ –¥–ª—è —Å–≤–æ—ó—Ö –∫–æ–ª–µ–≥‚ù§Ô∏èÔ∏è
'''


async def profile(msg: Message, user_db: UserRepo, point_db: PointRepo):
    user = await user_db.get_user(msg.from_user.id)
    points = await point_db.get_user_points(user.user_id, count=True)
    points_this_month = await point_db.get_user_points(user.user_id, count=True, this_month=True)
    text = (
        f'<b>–û—Ç—Ä–∏–º–∞–Ω—ñ wellcoin-–∏ üíö</b>\n'
        f'–í —Ü—å–æ–º—É –º—ñ—Å—è—Ü—ñ: {points_this_month}\n'
        f'–ó–∞ –≤–µ—Å—å –ø–µ—Ä—ñ–æ–¥: {points}\n\n'
        f'<b>–í —Ü—å–æ–º—É –º—ñ—Å—è—Ü—ñ —Ç–∏ –º–æ–∂–µ—à —â–µ –≤—ñ–¥–¥–∞—Ç–∏: {user.gift_points}üíö</b>'
    )
    await msg.answer(text, reply_markup=my_profile_kb)


async def rules(msg: Message):
    await msg.answer(rules_str, reply_markup=main_menu_kb)


async def info(msg: Message):
    text = (
        '–°—Ç–∞—Ç—Ç—è "5 –ø–µ—Ä–µ–≤–∞–≥ –≤–¥—è—á–Ω–æ—Å—Ç—ñ –¥–ª—è –∑–¥–æ—Ä–æ–≤\'—è"üíö\n\n'
        '–†–µ–∞–ª—å–Ω—ñ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è, —è–∫—ñ –ø–æ–∫–∞–∑—É—é—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω–∏–π –≤–ø–ª–∏–≤ '
        '–Ω–∞ –Ω–∞—à–µ –∑–¥–æ—Ä–æ–≤\'—è —Ç–∞ —Å–∞–º–æ–ø–æ—á—É—Ç—Ç—è:\n\nhttps://www.wellright.com/blog/5-wellness-benefits-of-gratitude '
    )
    await msg.answer(text, reply_markup=main_menu_kb)


async def unused_menu(msg: Message):
    await msg.answer('–¶–µ–π —Ä–æ–∑–¥—ñ–ª —É —Ä–æ–∑—Ä–æ–±—Ü—ñ üôÉ', reply_markup=main_menu_kb)


def setup(dp: Dispatcher):
    dp.register_message_handler(profile, text=Buttons.menu.my_profile, state='*')
    dp.register_message_handler(rules, text=Buttons.menu.rules, state='*')
    dp.register_message_handler(info, text=Buttons.menu.info, state='*')
